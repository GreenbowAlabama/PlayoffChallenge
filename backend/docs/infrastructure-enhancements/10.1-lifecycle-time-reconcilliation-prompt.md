You are acting as a senior backend architect in a Node + Express + PostgreSQL system.

Context:

• contest_instances table has:
  - id (uuid)
  - status (text)
  - lock_time (timestamptz)
  - start_time (timestamptz)
  - end_time (timestamptz)
  - updated_at (timestamptz)

• Lifecycle model:
  SCHEDULED → LOCKED → LIVE → COMPLETE

• Current state:
  - No automatic lifecycle reconciliation.
  - Stored status drifts from time reality.
  - Available endpoint has already been patched to filter joinable contests safely.

Goal:

Design and implement a deterministic background lifecycle reconciliation worker.

Constraints:

1. Must be idempotent.
2. Must NOT cause state regression.
3. Must respect transition ordering.
4. Must be safe to run every minute.
5. Must not break settlement logic.
6. Must not recompute COMPLETE back to earlier states.
7. Must log transitions.

Transition rules:

If status = 'SCHEDULED' AND now >= lock_time → set status = 'LOCKED'
If status = 'LOCKED' AND now >= start_time → set status = 'LIVE'
If status IN ('LIVE','LOCKED','SCHEDULED') AND now >= end_time → set status = 'COMPLETE'

Requirements:

1. Provide:
   - Reconciliation SQL logic
   - Safe UPDATE statements with deterministic WHERE clauses
   - Transaction boundary guidance
   - Suggested cron schedule
   - Optional advisory lock to prevent concurrent runs
2. Provide Express or standalone worker implementation.
3. Include logging strategy.
4. Include rollback safety considerations.
5. Include test strategy.
6. Include safe rollout plan.

Return:

• Reconciliation SQL
• Node worker implementation
• Cron configuration example
• Idempotency explanation
• Risk analysis
• Step-by-step deployment sequence
